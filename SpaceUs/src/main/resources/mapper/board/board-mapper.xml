<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
	<!-- boardList -->
	<select id="selectListBoard" resultMap="boardMap">
		select
			*
		from
			board
		order by
			board_no asc
	</select>
	<resultMap type="board" id="boardMap">

	</resultMap>

	<!-- groupBoard List -->
	<select id="selectListGroupBoard" resultMap="groupBoardMap">
		select
			G.*,
			(select nickname from member where member_email= G.member_email) nickname
		from
			group_board G
	</select>
	<resultMap type="groupBoard" id="groupBoardMap">
	</resultMap>

	<!-- sorted groupBoard List -->
	<select id="selectSortedListGroupBoard" resultMap="groupBoardMap">
  		select 
  			G.* ,
  			(select nickname from member where member_email= G.member_email) nickname
        from
            (
             select 
             	* 
             from 
             	board join group_board using(board_no) 
             <where>
   				<if test="boardRef != null and boardRef !=''">
   					board_no = #{boardNo}
   				</if>
   				<if test="boardRef.equals('')">
	             	board_ref = #{boardNo}          	
	             </if>	
             </where> 
             ) G
	</select>
	
	<!-- total Baord Cnt -->
	<select id="selectTotalCnt" resultType="_int">
		select
			count(*)
		from
			group_board
	</select>

	<!-- board Detail -->
	<select id="selectDetailBoard" resultMap="groupBoardMap">
		select
			G.*,
			(select nickname from member where member_email= G.member_email) nickname
		from
			group_board G
		where
			G.group_board_no=#{groupBoardNo}
	</select>
	
	<!-- insert board -->
	<insert id="insertBoard">
		insert into
			group_board
		values(
			'G'||seq_group_board_no.nextval,
			#{boardNo},
			#{memberEmail},
			default,
			#{groupBoardTitle},
			default,
			default,
			#{groupBoardContent}
		)
	</insert>
</mapper>